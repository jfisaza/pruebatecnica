<template lang="">
    <div>
        <!-- ENCABEZADO -->
        <header class="success">
            <h2>Prueba</h2>
            <div>
                <logout></logout>
            </div>
        </header>
        <section>
            <!-- DATOS DEL USUARIO -->
            <article class="card">
                <div class="card-header"><h1>Datos personales</h1></div>
                <div class="card-body">
                    <div class="user-photo"><font-awesome-icon icon="fa-solid fa-user" /></div>
                    <div class="user-info">
                        <b>Nombre: </b>
                        <span>{{ userData.nombre }}</span>
                        <br>
                        <b>Apellido: </b>
                        <span>{{ userData.apellido }}</span>
                        <br>
                        <b>Teléfono: </b>
                        <span>{{ userData.telefono }}</span>
                        <br>
                        <b>Correo: </b>
                        <span>{{ userData.correo }}</span>
                        <br>
                        <b>Saldo: </b>
                        <span>{{ saldoEnDolar }}</span>
                    </div>
                </div>
            </article>
            <!-- ACCIONES -->
            <article class="card">
                <div class="card-header"><h1>¿Que quieres hacer hoy?</h1></div>
                <div class="card-body">
                    <div class="action">
                        <font-awesome-icon class="icono" icon="fa-solid fa-user-pen" />
                        <br>
                        Actualizar tus datos
                    </div>
                    <div class="action">
                        <font-awesome-icon class="icono" icon="fa-solid fa-share" />
                        <br>
                        Enviar dinero
                    </div>
                    <div class="action">
                        <font-awesome-icon class="icono" icon="fa-solid fa-arrow-up-from-bracket" />
                        <br>
                        Cargar saldo
                    </div>
                </div>
            </article>
        </section>
    </div>
</template>
<script>
import Logout from '../components/Logout.vue'
import { ref, onMounted, inject, computed } from 'vue'
import { useStore } from '../store'
import { useRouter } from 'vue-router'

export default {
    components: {
        Logout
    },
    setup(){
        const axios = inject('axios')
        const swal = inject('$swal')
        const api = inject('api')

        const store = useStore()
        const router = useRouter()

        const userData = ref({
            identificacion: '',
            nombre: '',
            apellido: '',
            correo: '',
            telefono: '',
            saldo: 0
        })

        const saldoEnDolar = computed(() => {
            const options = { style: 'currency', currency: 'USD' };
            const currency = new Intl.NumberFormat('en-US', options);
            if(!userData.value.saldo) return currency.format(0)
            return currency.format(userData.value.saldo)
        })

        onMounted(() => {
            userData.value = store.user
            if(Object.values(userData.value).length == 0){
                let token = localStorage.getItem('token')
                if(token && token != ''){
                    axios.get(api+'getUser', {
                        headers: {
                            authorization: token
                        }
                    }).then(response => {
                        store.setUser(response.data.data)
                        userData.value = response.data.data
                    }).catch(error => {
                        router.replace('/')
                    })
                }
            }
        })

        return{
            userData,
            saldoEnDolar
        }
    }
}
</script>
<style lang="css" scoped>
    header{
        padding: 5px;
        display: flex;
    }

    header div{
        margin-left: auto;
    }

    .card-body{
        display: flex;
    }

    .user-photo{
        width: 100px;
        height: 150px;
        background-color: lightgray;
        color: white;
        font-size: 40px;
        text-align: center;
        line-height: 3.5;
        border-radius: 10px;
        margin: 5px;
    }

    .user-info{
        margin: 5px;
    }

    .user-info b{
        font-weight: bold;
    }

    .action{
        width: 100px;
        text-align: center;
        cursor: pointer;
    }

    .action:hover{
        opacity: .8;
    }

    .icono{
        font-size: 30px;
    }
</style>